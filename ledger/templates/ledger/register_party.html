{% extends 'base.html' %}
{% load static %}
{% load format_filters %}

{% block title %}Ø«Ø¨Øª Ø·Ø±Ù Ø­Ø³Ø§Ø¨{% endblock %}

{% block content %}
  <h2>Ø«Ø¨Øª Ø·Ø±Ù Ø­Ø³Ø§Ø¨</h2>

  <form method="post">
    {% csrf_token %}

    <div class="form-row">
      <label for="name">Ø·Ø±Ù Ø­Ø³Ø§Ø¨:</label>
      <input type="text" id="name" name="name" required>
    </div>

    <div class="form-row">
      <label for="role">Ù†Ù‚Ø´:</label>
      <select id="role" name="role" class="select2" required>
        <option value="customer">Ù…Ø´ØªØ±ÛŒ</option>
        <option value="supplier">ÙØ±ÙˆØ´Ù†Ø¯Ù‡</option>
        <!-- ğŸ”§ Ø¬Ø¯ÛŒØ¯: Ú¯Ø²ÛŒÙ†Ù‡Ù” Ù‡Ø±Ø¯Ùˆ
        <option value="both">Ù‡Ø±Ø¯Ùˆ</option> -->
      </select>
    </div>

    <button type="submit" class="submit-btn">Ø«Ø¨Øª Ø·Ø±Ù Ø­Ø³Ø§Ø¨</button>
  </form>

  {% if recent_parties %}
    <!-- ğŸ”§ Ø¬Ø¯ÛŒØ¯: ÙÛŒÙ„ØªØ± Ø³Ø±ÛŒØ¹ -->
    <div class="filters" style="margin:16px 0;">
      {% with active=request.GET.role %}
        <a href="{% url 'register_party' %}" class="{% if not active %}active{% endif %}">Ù‡Ù…Ù‡</a> |
        <a href="?role=cust" class="{% if active == 'cust' %}active{% endif %}">Ù…Ø´ØªØ±ÛŒ</a> |
        <a href="?role=supp" class="{% if active == 'supp' %}active{% endif %}">ÙØ±ÙˆØ´Ù†Ø¯Ù‡</a> |
      {% endwith %}
    </div>

    <h3 style="margin-top: 8px;">Û²Û° Ø·Ø±Ù Ø­Ø³Ø§Ø¨ Ø¢Ø®Ø±</h3>
    <div class="table-wrap table-scroll">
      <table class="table-pro">
        <thead>
          <tr>
            <th>Ù†Ø§Ù… Ø·Ø±Ù Ø­Ø³Ø§Ø¨</th>
            <th>Ù†Ù‚Ø´</th>
          </tr>
        </thead>
        <tbody>
          {% for p in recent_parties %}
            <tr>
              <td style="width:200px;" class="text-clip">{{ p.name }}</td>
              <td style="text-align:center;">
                {% if p.is_customer and p.is_supplier %}
                  <span class="badge badge-cus-sup">Ù…Ø´ØªØ±ÛŒ/ÙØ±ÙˆØ´Ù†Ø¯Ù‡</span>
                {% elif p.is_customer %}
                  <span class="badge badge-customer">Ù…Ø´ØªØ±ÛŒ</span>
                {% elif p.is_supplier %}
                  <span class="badge badge-supplier">ÙØ±ÙˆØ´Ù†Ø¯Ù‡</span>
                {% else %}
                  <span>â€”</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function(){
  if (window.jQuery) {
    $('#role').select2({
      width: '250px',
      dir: 'rtl',
      minimumResultsForSearch: Infinity
    });
  }
});
</script>
{% endblock %}
